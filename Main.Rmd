---
title: "SigMA Simulation"
output: html_notebook
---


```{r}
#Problem: Let coin A have an H probability of 0.2, and let coin B have an H probability of 0.8. This is a simulation for determining the optimal number of flips in order to deliver the highest sensitivity at a particular threshhold for the probability of success.
```



```{r}

library(stats4)
library(mvc)
```


```{r}
#Declare parameters
A_prob <- 0.4
B_prob <- 0.6

N_A <- 50
N_B <- 50
N_Tot <- N_A + N_B

bins <- 50
n_flips_sample <- 10
n_flips_test <- 10

sens_thresh <- 0.5
```
```{r}
#Obtain the number of A and B coins based on a single sample of a 100-sample Binomial distribution (ie. how many A coins in 100 trials, assuming each coin is equally likely to be picked)
set.seed(100)
binom <- rbinom(1, N_Tot, 0.5)
binom 
```
```{r}
#Flip each coin 10 times and compute the maximum likelihood of the observation
set.seed(100) 
A_flips <- rbinom(binom, n_flips_sample, A_prob)
B_flips <- rbinom(N_Tot - binom, n_flips_sample, B_prob)

A_vector <- c(rep(1, A_flips[2]), rep(0, n_flips_sample - A_flips[2]))

LL <- function(prob){
  R = dbern(A_vector, prob)
  -sum(log(R))
}

output <- mle(LL, start = list(prob = 0.5))
prob <- slot(output, 'coef')
prob[[1]]

```
```{r}
A_likelihoods <- c()
B_likelihoods <- c()

for (val in A_flips) {
  A_vector <- c(rep(1, val), rep(0, n_flips_sample - val))
  
  LL <- function(prob){
    R = dbern(A_vector, prob)
    -sum(log(R))
  }
  
  output <- suppressWarnings(mle(LL, start = list(prob = 0.9)))
  prob <- slot(output, 'coef')
  
  A_likelihoods <- c(A_likelihoods, prob[[1]])
}


for (val in B_flips) {
  B_vector <- c(rep(1, val), rep(0, n_flips_sample - val))
  
  LL <- function(prob){
    R = dbern(B_vector, prob)
    -sum(log(R))
  }
  
  output <- suppressWarnings(mle(LL, start = list(prob = 0.9)))
  prob <- slot(output, 'coef')
  
  B_likelihoods <- c(B_likelihoods, prob[[1]])
}


```
```{r}
B_likelihoods
```


```{r}
#Bin the maximum likelihoods and compute classification correctness based on sensitivity threshhold
A_binned <- round(A_likelihoods, digits = 1)
B_binned <- round(B_likelihoods, digits = 1)

A_unique <- unique(A_binned)
B_unique <- unique(B_binned)

A_counts <- rep(0, length(A_unique))
B_counts <- rep(0, length(B_unique))
for (i in 1:length(A_unique)) {
  for (j in A_binned) {
    if (j == A_unique[i]) {
      A_counts[i] <- A_counts[i] + 1
    }
  }
}
for (i in 1:length(B_unique)) {
  for (j in B_binned) {
    if (j == B_unique[i]) {
      B_counts[i] <- B_counts[i] + 1
    }
  }
}

A_unique
A_counts
B_unique
B_counts
```
```{r}
#Get the corresponding SigMA score
master_set <- c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1)
SigMA_scores <- rep(0, 11)

for (index in 1:length(master_set)) {
  num <- master_set[index]
  if (num %in% A_unique) {
    A_index <- match(num, A_unique)
    if (num %in% B_unique) {
      B_index <- match(num, B_unique)
      SigMA_scores[index] <- (A_counts[A_index] / (A_counts[A_index] + B_counts[B_index]))
      #print(SigMA_scores)
    } else{
      SigMA_scores[index] <- 1
    }
  } else if ((num %in% B_unique)) {
    SigMA_scores[index] <- 1
  } else {
    SigMA_scores[index] <- 0.5
  }
}

SigMA_scores
```


```{r}
#Classify based on sensitivity threshhold
classified <- c()
for (prob in SigMA_scores) {
  if (prob >= sens_thresh) {
    classified <- c(classified, 1)
  } else {
    classified <- c(classified, 0)
  }
}
classified
```
```{r}
#Test based on a random coin
A_likelihoods <- c()
B_likelihoods <- c()

for (val in A_flips) {
  A_vector <- c(rep(1, val), rep(0, n_flips_sample - val))
  
  LL <- function(prob){
    R = dbern(A_vector, prob)
    -sum(log(R))
  }
  
  output <- suppressWarnings(mle(LL, start = list(prob = 0.9)))
  prob <- slot(output, 'coef')
  
  A_likelihoods <- c(A_likelihoods, prob[[1]])
}


for (val in B_flips) {
  B_vector <- c(rep(1, val), rep(0, n_flips_sample - val))
  
  LL <- function(prob){
    R = dbern(B_vector, prob)
    -sum(log(R))
  }
  
  output <- suppressWarnings(mle(LL, start = list(prob = 0.9)))
  prob <- slot(output, 'coef')
  
  B_likelihoods <- c(B_likelihoods, prob[[1]])
}

```



Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

